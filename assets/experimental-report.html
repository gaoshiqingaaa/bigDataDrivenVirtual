<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>实验报告</title>
    <link rel="stylesheet" href="../lib/css/layui.css">
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/teacher-experimental-report.css" />
    <link rel="stylesheet" href="../css/public.css" />
</head>
<body>
<div class="box2">
    <div id="nav">
        <a href="../index.html"><button type="button" class="layui-btn2  layui-btn-primary" id="but1"><p class="navfont">返回</p></button></a>
        <!-- <button type="button" class="layui-icon layui-icon-friends" id="friends"></button>
        <button type="button" class="layui-icon layui-icon-help" id="help"></button> -->
    </div>

    <div class="logoweizi"></div>

    <div class="shiyanfont1">大数据驱动的智能投顾虚拟仿真实验室</div>
    
    <a href="#"><div id="div1imgdownload"></div></a>

    <div class="div1">
        
        

        <div class="shiyanfont2">实验报告</div>

        <div class="div11">
            <div class="div111">
            <div class="div11img1"></div>
            <div class="div11font"><span>实验名称</span></div>
            </div>
            <div class="div21font">
                <p class="ex-purpose">湖北经济学院智能投顾实验系统</p>
            </div>
        </div>
        
        <div class="div12">
            <div class="div111">
            <div class="div11img2"></div>
            <div class="div12font"><span>实验原理</span></div>
            </div>
            <div class="div21font">
                <p class="ex-principle">
                    金融科技背景下智能投顾市场发展潜力巨大，对复合型高层次金融专业人才 需求日益迫切。本实验项目高度模拟了智能投顾平台的核心流程与功能，为学生提供了深度学习金融科技创新应 <br>
                    用的良好平台。实验帮助学生综合运用现代投资组合理论（MPT)、数据分析、Python等技术，为虚拟的不同偏好的投资者进行风险评估和客户画像，推送以中国 ETF 为标的的定制化资产<br>
                    组合配置方案和动态优化建议，掌握金融科技最具代表意义的智能投顾平台的虚拟仿真运作原理，为步入金融科技工作岗位奠定坚实的理论功底，积累丰富的实战经验。
                </p>
            </div>
        </div>

        <div class="div13">
            <div class="div111">
            <div class="div11img3"></div>
            <div class="div12font"><span>实验环节及得分</span></div>
            </div>
            <div class="div21font">

               <p class="div13font1">1、快问快答</p>
                <div class="div131">
                    <table class="div13tb1">
                        <tr>
                            <td class="div13tb1fontsize">题号</td>
                            <td class="div13tb1fontsize">1</td>
                            <td class="div13tb1fontsize">2</td>
                            <td class="div13tb1fontsize">3</td>
                            <td class="div13tb1fontsize">4</td>
                            <td class="div13tb1fontsize">5</td>
                            <td class="div13tb1fontsize">6</td>
                            <td class="div13tb1fontsize">7</td>
                            <td class="div13tb1fontsize">8</td>
                            <td class="div13tb1fontsize">9</td>
                            <td class="div13tb1fontsize">10</td>
                            <td class="div13tb1fontsize">11</td>
                            <td class="div13tb1fontsize">12</td>
                            <td class="div13tb1fontsize">13</td>
                            <td class="div13tb1fontsize">14</td>
                            <td class="div13tb1fontsize12">15</td>
                        </tr>

                        <tr>
                            <td class="div13tb1fontsize1">得分</td>
                            <td id="ti1" class="div13tb1fontsize1"></td>
                            <td id="ti2" class="div13tb1fontsize1"></td>
                            <td id="ti3" class="div13tb1fontsize1"></td>
                            <td id="ti4" class="div13tb1fontsize1"></td>
                            <td id="ti5" class="div13tb1fontsize1"></td>
                            <td id="ti6" class="div13tb1fontsize1"></td>
                            <td id="ti7" class="div13tb1fontsize1"></td>
                            <td id="ti8" class="div13tb1fontsize1"></td>
                            <td id="ti9" class="div13tb1fontsize1"></td>
                            <td id="ti10" class="div13tb1fontsize1"></td>
                            <td id="ti11" class="div13tb1fontsize1"></td>
                            <td id="ti12" class="div13tb1fontsize1"></td>
                            <td id="ti13" class="div13tb1fontsize1"></td>
                            <td id="ti14" class="div13tb1fontsize1"></td>
                            <td id="ti15" class="div13tb1fontsize13"></td>
                        </tr>
                    </table>
                </div>

                <p class="div13font2">2、风险评测</p>
                    <div class="div132">
                        <table class="div13tb2">
                            <tr>
                                <td class="div13tb2td1font">平测结果</td>
                                <td class="div13tb1td1" id="User_investment_type">保守型/相对保守型/稳健型/相对积极型/积极型</td>
                            </tr>
                        </table>
                    </div>

                <p class="div13font3">3.实验步骤</p>
                    <div class="div133">
                        <table class="div13tb3">
                            <tr>
                                <td class="div13tb3td1">实验步骤</td>
                                <td class="div13tb3td2" style="background-color: #5C6C91; color: #FFFFFF;">代码</td>
                                <td class="div13tb3td2" style="background-color: #5C6C91; color: #FFFFFF;">运行结果</td>
                                <td class="div13tb3td3" style="background-color: #5C6C91; color: #FFFFFF;">得分</td>
                            </tr>

                            <tr>
                                <td class="div13tb3td1 tdfont">资产大类数据准备</td>
                                <td class="div13tb3td2">
                                    <img id="code1" style="width: 100%;">
                                </td>
                                <td class="div13tb3td2">
                                    <img id="Operation_results1" style="width: 100%;">
                                </td>
                                <td class="div13tb3td3" id="shiyaniti1"></td>
                            </tr>
                            
                            <tr>
                                <td class="div13tb3td1 tdfont">计算年化收益率</td>
                                <td class="div13tb3td2">
                                    <img id="code2" style="width: 100%;">
                                </td>
                                <td class="div13tb3td2">
                                    <img id="Operation_results2" style="width: 100%;">
                                </td>
                                <td class="div13tb3td3" id="shiyaniti2"></td>
                            </tr>
                            
                            <tr>
                                <td class="div13tb3td1 tdfont">计算年化标准差</td>
                                <td class="div13tb3td2">
                                    <img id="code3" style="width: 100%;">
                                </td>
                                <td class="div13tb3td2">
                                    <img id="Operation_results3" style="width: 100%;">
                                </td>
                                <td class="div13tb3td3" id="shiyaniti3"></td>
                            </tr>

                            <tr>
                                <td class="div13tb3td1 tdfont">相关性系数矩阵</td>
                                <td class="div13tb3td2">
                                    <img id="code4" style="width: 100%;">
                                </td>
                                <td class="div13tb3td2">
                                    <img id="Operation_results4" style="width: 100%;">
                                </td>
                                <td class="div13tb3td3" id="shiyaniti4"></td>
                            </tr>

                            <tr>
                                <td class="div13tb3td1 tdfont">构建组合的Effcient Frontier</td>
                                <td class="div13tb3td2">
                                    <img id="code5" style="width: 100%;">
                                </td>
                                <td class="div13tb3td2">
                                    <img id="Operation_results5" style="width: 100%;">
                                </td>
                                <td class="div13tb3td3" id="shiyaniti5"></td>
                            </tr>

                            <tr>
                                <td class="div13tb3td1 tdfont">计算资产配置权重</td>
                                <td class="div13tb3td2">
                                    <img id="code6" style="width: 100%;">
                                </td>
                                <td class="div13tb3td2">
                                    <img id="Operation_results6" style="width: 100%;">
                                </td>
                                <td class="div13tb3td3" id="shiyaniti6"></td>
                            </tr>

                            <tr>
                                <td class="div13tb3td11 tdfont">半年后总收益</td>
                                <td class="div13tb3td21">
                                    <img id="code7" style="width: 100%;">
                                </td>
                                <td class="div13tb3td21">
                                    <img id="Operation_results7" style="width: 100%;">
                                </td>
                                <td class="div13tb3td31" id="shiyaniti7"></td>
                            </tr>
                        </table>
                    </div>
                
                <p class="div13font4">4、实验成绩</p>
                    <div class="div134">
                        <table class="div13tb4">
                            <td class="div13tb2td1font">总分</td>
                            <td class="div13tb1td1" id="zongfen"></td>
                        </table>
                    </div>
                </div>
        </div>

        <div class="div14">
            <div class="div111">
            <div class="div11img4"></div>
            <div class="div12font"><span>心得体会</span></div>
            </div>

                <div class="layui-input-block">
                  <textarea id="utext" class="layui-textarea border"></textarea>
                </div>
            

        </div>
    </div>

    <div class="div1btn">
        <button type="button" class="layui-btn1 layui-btn-primary" id="tijiao"><p class="font">提交</p></button>
    </div>
    
</div>
</body>
<script src="../lib/layui.js"></script>
<script src="../js/jquery-2.1.4.js"></script>
<script src="../lib/layui.all.js"></script>
<script src="../js/jquery.min.js"></script>

<!-- 下载为PDF -->
 	<script src="../js/html2canvas.js"></script>
    <script src="../js/jspdf.min.js"></script>
    <script type="text/javascript">
    $(function(){
    	$(document).on('click','#div1imgdownload',function(){
        	var pdf = new jsPDF('p','pt','a4');
	        pdf.internal.scaleFactor = 1;  //可以调整缩放比例
	        var options = {
	            //pagesplit: true //分页
	            pagesplit: false//不分页
	        };
        	pdf.addHTML($('.div1').get(0),0,0,options,function() {
	            pdf.save($('.header .h1Title').text()+'.pdf');
	        });
        })
    })
</script>

<script>
    //快问快答得分
    const a = JSON.parse(localStorage.getItem("test_value"));
        $("#ti1").html(String(a["ti1"]));
        $("#ti2").html(String(a["ti2"]));
        $("#ti3").html(String(a["ti3"]));
        $("#ti4").html(String(a["ti4"]));
        $("#ti5").html(String(a["ti5"]));
        $("#ti6").html(String(a["ti6"]));
        $("#ti7").html(String(a["ti7"]));
        $("#ti8").html(String(a["ti8"]));
        $("#ti9").html(String(a["ti9"]));
        $("#ti10").html(String(a["ti10"]));
        $("#ti11").html(String(a["ti11"]));
        $("#ti12").html(String(a["ti12"]));
        $("#ti13").html(String(a["ti13"]));
        $("#ti14").html(String(a["ti14"]));
        $("#ti15").html(String(a["ti15"]));



    //获取临时userid
    const temporary_user = JSON.parse(localStorage.getItem("temporary_user"));

    //获取用户投资类型
    const user_investment_type = JSON.parse(localStorage.getItem("Grades"));
    $("#User_investment_type").html(String(user_investment_type["grade"]));
    //获取图片
    $.ajax({
    /* url 地址可以是 /get-json/ 的方式
    *  也可以是 http://www.qfedu.com/get-json/ 的方式
    */
    url: 'http://47.97.205.240:8800/result',
    // url: 'http://127.0.0.1:8800/result',
    type: 'POST',
    dataType: 'json',
    data:{"user":temporary_user},
    // data:{"user":"b1a438cf-85c3-4d04-bec4-02a37ea2588d"},
    success: function(data){
        // localStorage.setItem("Experimental_report", JSON.parse(data));
        // 成功处理逻辑
        // 展示代码&代码运行结果的图片
        $("#code1").attr('src',"http://47.97.205.240:8800"+data.code[0]);
        $("#Operation_results1").attr('src',"http://47.97.205.240:8800"+data.print[0]);
        $("#code2").attr('src',"http://47.97.205.240:8800"+data.code[1]);
        $("#Operation_results2").attr('src',"http://47.97.205.240:8800"+data.print[1]);
        $("#code3").attr('src',"http://47.97.205.240:8800"+data.code[2]);
        $("#Operation_results3").attr('src',"http://47.97.205.240:8800"+data.print[2]);
        $("#code4").attr('src',"http://47.97.205.240:8800"+data.code[3]);
        $("#Operation_results4").attr('src',"http://47.97.205.240:8800"+data.print[3]);
        $("#code5").attr('src',"http://47.97.205.240:8800"+data.code[4]);
        $("#Operation_results5").attr('src',"http://47.97.205.240:8800"+data.print[4]);
        $("#code6").attr('src',"http://47.97.205.240:8800"+data.code[5]);
        $("#Operation_results6").attr('src',"http://47.97.205.240:8800"+data.print[5]);
        $("#code7").attr('src',"http://47.97.205.240:8800"+data.code[6]);
        $("#Operation_results7").attr('src',"http://47.97.205.240:8800"+data.print[6]);

        //获取代码得分
        step_score = JSON.parse(localStorage.getItem('step_score'))

        // 展示代码得分
        $("#shiyaniti1").html(String(step_score[0]));
        $("#shiyaniti2").html(String(step_score[1]));
        $("#shiyaniti3").html(String(step_score[2]));
        $("#shiyaniti4").html(String(step_score[3]));
        $("#shiyaniti5").html(String(step_score[4]));
        $("#shiyaniti6").html(String(step_score[5]));
        $("#shiyaniti7").html(String(step_score[6]));
        
        // 计算总分
        list1=[step_score[0],step_score[1],step_score[2],step_score[3],step_score[4],step_score[5]
            ,step_score[6],a["ti1"],a["ti2"],a["ti3"],a["ti4"],a["ti5"],a["ti6"],a["ti7"],a["ti8"],a["ti9"],a["ti10"]
            ,a["ti11"],a["ti12"],a["ti13"],a["ti14"],a["ti15"]]
        $("#zongfen").html(String(sum(list1)));
     },
    error: function(res){
        // 错误时处理逻辑
        layer.alert('无数据,请您先完成实验!')
        }
            });

    function sum(arr) {
            var s = 0;
            for (var i=arr.length-1; i>=0; i--) {
                s += arr[i];
                }
                return s;
            }
        
</script>

<!-- 提交 -->
<script>
    $('button:button[id="tijiao"]').click(function(){ 
        var utextinput = document.getElementById("utext");
        var text = utextinput.value; 
        let data={
	  user: temporary_user,
	  principle : $('.ex-principle').text(),//实验原理
                  objective : $('.ex-purpose').text(),//实验目的
                  answer:JSON.parse(localStorage.getItem('test_value')),//快问快答
                  assessment : $('#User_investment_type').text(),//风险评测
                  procedures:JSON.parse(localStorage.getItem("Experimental_report")),//获取实验步骤
                  grade : String($.s),//实验成绩
                  realize : String(text)}//心得体会
        $.ajax({
        url: 'http://47.97.205.240:8800/result',
        // url: 'http://127.0.0.1:8800/result',
        type: 'POST',
        dataType: 'json',
        data:data,
        success: function(data){
            layer.alert("您已提交成功")
        }, error: function(res){
            layer.alert("提交失败")
        }

        })
        
        
        
    });
    
</script>


</html>
